<%= render "shared/otherheader" %>
<div class="new__post__header">
</div>
<div class="show__main">
<div class="show__contents__area">
<div class="show__title">
 <%= @post.title %><br>
 </div>
 
 <div class="show__image">

 <%= image_tag @post.image , class:"show__item-img" %><br>

 </div>
 <div class="show__nickname">
 <%= @post.user.nickname %><br>
 </div>
 <%= @post.content%><br>
  <% if @post.favorited_by?(current_user) %>
    <%= link_to post_favorites_path(@post), method: :delete, class: "favorite_btn" do %>
     ♥<%= @post.favorites.count %> 
    <% end %>
    <% else %>
     <%= link_to post_favorites_path(@post), method: :post, class: "favorite_btn" do %>
      ♡<%= @post.favorites.count %> 
     <% end %>
    <% end %>
 <%= @post.province.name %><div>ここに、天気APIをのせる。</div><br>
 <% if @post.address.present? %>
 <div class="map__area">
 <div class="map__introduce">おすすめの目的地</div>
 <div id="map"></div>
 </div>
 <script>
  let map
  function initMap() {
    geocoder = new google.maps.Geocoder()
    var test ={lat:<%= @post.latitude %>, lng:<%= @post.longitude %>};

    map = new google.maps.Map(document.getElementById('map'),{
      center: test,
      zoom: 15,
      mapTypeControl: false,
      streetViewControl: false
    });
    
    var contentString = '住所: <%= @post.address %>';
    var infoWindow = new google.maps.InfoWindow({
      content: contentString
    });

    marker = new google.maps.Marker({
      position: test,
      map: map,
      title: contentString
    });
  }
 </script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%=ENV['MAP_API_KEY']%>&callback=initMap"></script>
<% end %>

 <% if current_user.id == @post.user.id && user_signed_in? %>
 <%= link_to "edit", edit_post_path(@post) , method: :get %>
 <%= link_to "delete", post_path(@post),id: "post__destroy", method: :delete %>
  <%= render partial: 'comments/chat_post', locals: { comment: @comment, post: @post } %><br><%#チャットおかしい。%>
 <% else %>
  <%= render 'comments/chat_post' %><br>
 <% end %>

 <div id="list">
</div>
   <% @post.comments.sort.reverse.each do |comments| %>
    <div class="post__chats">
    <div class="post__time">
    <%= l comments.created_at %><br>
    </div>
    <div class="post__chat">
   <%= comments.chat %><br>
   </div>
   <div class="post__chat__name">by<%= comments.user.nickname %></div><br>
   <% if current_user.id == comments.user_id%>
   <div class="chat__edit"><%= link_to 'chat edit', edit_post_comment_path(comments.id) %></div>
   <div class="chat__destroy"><%= link_to 'chat delete',  post_comment_path(comments.id),method: :delete %></div><br>
   <% end %>
   </div>
   <% end %>
 </div>
 </div>
 <%= link_to "メインページに戻る", root_path, class: 'btn'%>

<%= render "shared/footer" %>